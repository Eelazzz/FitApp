<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Сканирование EAN-кода</title>
</head>
<body>
  <h1>Сканировать штрих-код (EAN)</h1>

  <input type="text" id="eanResult" placeholder="Здесь появится EAN код" style="width:300px; height:30px; font-size:16px;">
  <br><br>
  <button id="scanButton" style="padding:10px 20px; font-size:16px;">Сканировать</button>

  <div style="margin-top:20px;">
    <video id="video" width="300" height="200" style="border:1px solid black; display:none;"></video>
  </div>

  <script type="module">
    import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/browser@0.0.10/+esm';

    const scanButton = document.getElementById('scanButton');
    const eanResult = document.getElementById('eanResult');
    const video = document.getElementById('video');

    const codeReader = new BrowserMultiFormatReader();

    scanButton.addEventListener('click', async () => {
      video.style.display = 'block'; // Показать видео

      try {
        const controls = await codeReader.decodeFromVideoDevice(null, video, (result, error, controls) => {
          if (result) {
            const text = result.getText();
            const format = result.getBarcodeFormat();

            console.log('Распознан код:', text, 'Формат:', format);

            // Проверяем формат
            if (format.includes('EAN_13') || format.includes('EAN_8')) {
              eanResult.value = text;
              controls.stop(); // Останавливаем только если это EAN
              video.style.display = 'none'; // Скрываем видео
            }
          }
          // Ошибки ловить необязательно — сканирование продолжается
        });

      } catch (error) {
        console.error('Ошибка при запуске сканера:', error);
      }
    });
  </script>
</body>
</html>
